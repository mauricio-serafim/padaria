<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout">
	<head>
		<link rel="stylesheet" type="text/css" th:href="@{fontawesome/css/all.min.css}">
		<link rel="stylesheet" type="text/css" th:href="@{materialize/css/materialize.min.css}">
		<style>
			body {
				display: flex;
				min-height: 100vh;
				flex-direction: column;
			}
			main {
				flex: 1 0 auto;
			}
			body {
				background: #fff;
			}
			#fundo-externo {
			    overflow: hidden; /* para que não tenha rolagem se a imagem de fundo for maior que a tela */
			    width: 100%;
			    height: 100%;
			    position: absolute; /* criamos um contexto para posicionamento */
			    z-index: -1000;
			}
			#fundo {
			    position: absolute; /* posição fixa para que a possível rolagem da tela não revele espaços em branco */
			    width: 100%;
			    height: 100%;
			}
			#fundo img {
			    width: 100%; /* com isso imagem ocupará toda a largura da tela. Se colocarmos height: 100% também, a imagem irá distorcer */
			    position: absolute;
			}
		</style>
	</head>
	
	<body>
		<div id="fundo-externo">
		    <div id="fundo">
		        <img src="/img/background.jpg" alt="" />
		    </div>
		</div>
		
		<nav>
		    <div class="nav-wrapper black">
		      <a href="#" class="brand-logo right"><img src="/img/logo.png"></a>
		      <ul id="nav-mobile" class="left hide-on-med-and-down">
		        <li><a href="/vendas">Realizar vendas</a></li>
		        <li><a href="/estoque">Estoque</a></li>
		        <li><a href="/usuarios">Cadastrar usuários</a></li>
		        <li><a href="/">Sair</a></li>
		      </ul>
		    </div>
		</nav>

		<div class="container white">
			<a href="#!" class="btn" id="loadProdutos">Carregar produtos</a>
			<table class="striped" id="tb">
				<thead>
					<tr>
						<th>Código</th>
						<th>Descrição</th>
						<th>GTIN</th>
						<th>Unidade</th>
						<th>Categoria</th>
						<th>Comercializável</th>
						<th>Venda liberada</th>
					</tr>
				</thead>
				<tbody id="corpo"></tbody>
			</table>
		</div>

		<script type="text/javascript" th:src="@{jquery/jquery-3.5.1.min.js}"></script>
		<script type="text/javascript" th:src="@{materialize/js/materialize.min.js}"></script>

		<script type="text/javascript">
			var listaProdutos;

			$().ready(function(){
				$("#loadProdutos").on("click", function(){
					data = "";

					$.get("/lista", function(data){
								listaProdutos = data;
								makeTable(data);
							});
					
					return false;
				});
			});
			
			function desabilitavenda(codigo){
				var url = "/desabilitavenda/" + codigo;
				console.log(url);

				$.get(url);
				
				return false;
			}
			
			function habilitavenda(codigo) {
				var url = "/habilitavenda/" + codigo;
				console.log(url);

				$.get(url);
				
				return false;
			}

			function makeTable(data){
				data.forEach(linha => {
					var str = "";
					str += "<td>" + linha.codigo + "</td>";
					str += "<td>" + linha.descricao + "</td>";
					str += "<td>" + linha.gtin +"</td>";
					str += "<td>" + linha.unidade.nome + "</td>";
					str += "<td>" + linha.categoria.nome + "</td>";
					str += linha.comercializavel ? "<td><i class=\"fas fa-check green-text\"></i></td>" : "<td><i class=\"fas fa-times red-text\"></i></td>";
					str += linha.vendaLiberada ? "<td><a href=\"#!\" onclick=\"desabilitavenda(" + linha.id + ")\"><i class=\"fas fa-check green-text\"></i></a></td>" : "<td><a href=\"#!\" onclick=\"habilitavenda(" + linha.id + ")\"><i class=\"fas fa-times red-text\"></i></a></td>";

					str = "<tr>" + str + "</tr>";
					
					console.log(str);

					$("#corpo").append(str);
				});
			}
		</script>
	</body>
</html>
